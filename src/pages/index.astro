---
import Base from '../layouts/Base.astro';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import { getCollection } from 'astro:content';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const latestPosts = (await getCollection('blog'))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 5);
---

<Base title={SITE_TITLE}>
  <Fragment slot="head">
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </Fragment>
  <Header />
  <div class="card" style="margin-top: 1.5rem;">
    <h1 style="margin: 0 0 0.5rem 0;">{SITE_TITLE}</h1>
    <p class="muted" style="margin: 0 0 1.5rem 0;">{SITE_DESCRIPTION}</p>
    <div class="hr" />
    <h2 style="margin: 1rem 0 0.5rem 0; font-size: 1.25rem;">Latest posts</h2>
    <ul style="list-style: none; margin: 0; padding: 0;">
      {latestPosts.map((post) => (
        <li style="margin-bottom: 0.75rem;">
          <a href={`/posts/${post.id}/`}>{post.data.title}</a>
          <span class="muted" style="margin-left: 0.5rem; font-size: 0.875rem;">
            <FormattedDate date={post.data.pubDate} />
          </span>
        </li>
      ))}
    </ul>
    <p style="margin: 1rem 0 0 0;">
      <a href="/posts/">All posts â†’</a>
    </p>
  </div>
  <Footer />
</Base>
